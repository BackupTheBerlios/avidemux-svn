<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-2">
<link title="new" rel="stylesheet" href="../plop.css" type="text/css">
<title>Avidemux 
	
		Documentation
	
-- 
	Nahrávání z TV a export do SVCD, napsal Jens</title>
</head>
<body style="margin-left:0px;margin-top:0px;" bgcolor="#ffffff"><table width="100%" border="0" cellspacing="0" cellpadding="0"><tr><td valign="top" align="right" colspan="1" bgcolor="#ffffff"><table border="0" cellspacing="0" cellpadding="0" width="100%"><tr><td width="99%" class="content" valign="top" align="left">
<br><p class="dochead">Nahrávání z TV a export do SVCD, napsal Jens</p>
<p class="chaphead"><span class="chapnum"><a name="doc_chap1">1.</a></span>Nahrávání</p>
<p class="secthead"><a name="doc_chap1_sect1">Úvod </a></p>
<p>
Koupil jsem si Pinnacle PCTV Pro, která by mìla být schopna zachytávat softwarem komprimované MPEG-2 video v DVD kvalitì. Z TV karty vede do zvukové karty audio kabel - externí nebo interní.
</p>
 <p>
Pro nahrávání v Linuxu se mi osvìdèil program Romana Hochleitnera <a href="http://frost.htu.tuwien.ac.at/%7Eroman/nuppelvideo/">NuppelVideo</a>. U nìj je dùle¾itý údaj o duplikovaných (zkopírovaných) snímcích. Zkopírovaný snímek je vytvoøen z pøedchozího snímku, pokud vypadne skuteèný snímek z obrazu. To je potøeba k udr¾ení synchronizace se zvukem. Na konci nahrávání uvidíte jak na tom jste. Pokud máte nula, jeden nebo dva duplikované snímky, máte skvìlý zdroj pro dal¹í kroky. Pokud máte hodnì zkopírovaných snímkù (èasto mnoho pohromadì), máte problém se svým hardware nebo jste pøi nahrávání pøíli¹ intenzivnì pracovali se svým systémem. ;-)
</p>
 <p>
 Budete také potøebovat nastavit dvì volby jaderného modulu bttv. To mù¾ete udìlat v souboru /etc/modules.conf:
</p>
<ul>
<a name="doc_chap_pre1"></a><table class="ntable" width="100%" cellspacing="0" cellpadding="0" border="0">
<tr><td class="infohead" bgcolor="#7a5ada"><p class="caption">
			Code listing .1</p></td></tr>
<tr><td bgcolor="#ddddff"><pre>

###
### Video
###
options bttv fieldnr=1 gbuffers=2
alias char-major-81 bttv
</pre></td></tr>
</table>
</ul>
<p>
 Nahrávací program nuvrec vytvoøí jeden nebo více výstupních souborù, ka¾dý o velikosti 2 GB. Proto¾e mi to moc nevyhovuje, napsal jsem tento malý <a href="NuppelVideo-jsc2G.patch">patch</a>. S pøepínaèem "-2" docílíte pùvodního chování, bez tohoto pøepínaèe bude výstupem jeden velký soubor.
 </p>
 <p>
 nuvrec ukládá video komprimované kodekem RTjpeg - je to men¹í bratøíèek formátu MJPEG. Kanál si musíte zvolit jiným programem (xawtv), ukonèit jej a spustit nuvrec. Kvalita pøes koaxiální kabel není dobrá. Tak¾e pou¾ívám kompozitní vstup na své TV kartì a linkový vstup na zvukové kartì Ensoniq ES1371. Pro pou¾ití v¾dy stejného audio profilu jsem vytvoøil speciální soubor.
 </p>
 <p class="secthead"><a name="doc_chap1_sect2">
 Zachytávání videa
  </a></p>
<p>
Podle toho jaký máte systém mo¾ná budete chtít zakomentovat OSS a odstranit komentáø u ALSA.
<ul>
<a name="doc_chap_pre2"></a><table class="ntable" width="100%" cellspacing="0" cellpadding="0" border="0">
<tr><td class="infohead" bgcolor="#7a5ada"><p class="caption">
			Code listing .2</p></td></tr>
<tr><td bgcolor="#ddddff"><pre>
# ulo¾í souèasný zvukový profil
#/usr/sbin/alsactl -f /tmp/audio_profile store  # pro ALSA zvuk
/usr/bin/aumix     -f /tmp/audio_profile -S     # pro OSS
# naète zvukový profil nahrávání videa
#
#/usr/sbin/alsactl -f /etc/asound.composite_video restore       # ALSA
/usr/bin/aumix     -f /etc/<a href="aumix.composite_video">aumix.composite_video</a> -L &gt;/dev/null  
# OSS
# spustí nahrávání
nuvrec -H 576 -W 720 -a 32768 -N -S 1 video.nuv
# -H 576 -W 720 pro DVD kvalitu - pou¾ívejte dobré hodnoty, výsledek nebude nikdy
#               lep¹í ne¾ zdroj
# -a 32768      pro 50% hlasitost zvuku - 2 fáze:
#                1. tato hlasitost jde do linkového vstupu pøes interní/externí
#                   audio kabel do zvukové karty
#                2. nahrávácí hlasitost zvukové karty je nastavena na¹ím zvukovým
#                   profilem vý¹e
#               proto¾e mám zapojen kabel pøímo z VHS do zvukové karty, tato hodnota
#               u mì nemá ¾ádný vliv
# -N            bez (LZO) komprese
# -S 1          Video zdroj: 0 koaxiální kabel
#                            1 kompozitní video
# obnoví zvukový profil
#
#/usr/sbin/alsactl -f /tmp/audio_profil restore       
# ALSA
/usr/bin/aumix     -f /tmp/audio_profil -L &gt;/dev/null  
# OSS
# úklid
rm -f /tmp/audio_profile
</pre></td></tr>
</table>
</ul>
</p>
<p class="secthead"><a name="doc_chap1_sect3">
 Nahrávání s programem ffv1rec
  </a></p>
	<p>Máte-li rychlý procesor, mù¾ete pou¾ívat <a href="./ffv1rec.xml.html">ffv1rec</a>, který má lep¹í obraz pøi ni¾¹í velikosti souboru za cenu mnohem vìt¹ího vytí¾ení procesoru.
	</p>
	<p>Základy z pøedchozí sekce platí i zde, proto¾e se generují modifikované nuv soubory.
	</p>
<p class="chaphead"><span class="chapnum"><a name="doc_chap2">2.</a></span>Komprese do MPEG-2/SVCD</p>
<p>
 	Úèelem tohoto odstavce je pøipravit <a href="./edl.xml.html">EDL/projektový soubor</a>, obsahující soubor s pùvodní nahrávkou, vystøi¾enými reklamami a vyèi¹tìným obrazem.
</p>
<p class="secthead"><a name="doc_chap2_sect1">Vytvoøení indexu </a></p>
<p>Nejdøíve vytvoøíme index souboru pro pozdìj¹í rychlé naètení.</p>
<p>
Otevøete soubor - <span class="code">File-&gt;Open Video</span>: <span class="input">video.nuv</span>. Po dokonèení naèítání budete vyzváni k ulo¾ení indexu: video.nuv.idx.</p>
<p>
Otevøete vygenerovaný index.</p>
   
<p class="secthead"><a name="doc_chap2_sect2">Vystøi¾ení reklam </a></p>
	<p>
	Pro ka¾dou ne¾ádoucí èást nastavte znaèku A na zaèátek èásti, kterou chcete odstranit, stiskem <img src="../images/marka.png">, potom pøejdìte na první snímek následující <b>po</b> posledním snímku reklamy a kliknìte na <img src="../images/markb.png">.
	</p>
<p>
	To vybere oblast [znaèka A, znaèka B[.
	</p>
<p>
	Stisknìte <span class="code">Ctrl+X</span>. Postup zopakujte pro odstranìní v¹ech reklam.
	</p>
<p>
	Kdy¾ jste s výsledkem spokojeni, ulo¾te EDL soubor pomocí <span class="code">Edit-&gt;Save Edit List</span>.
	 Napøíklad video.edl.
	 </p>
<p>
	 Teï máme <a href="./edl.xml.html">EDL</a> soubor obsahující pouze zajímavou èást videa.
	</p>
   
  <p class="secthead"><a name="doc_chap2_sect3">Komprese zvuku v Avidemuxu </a></p>

	<p>Otevøete EDL soubor a nastavte zvukové filtry tlaèítkem
	<img src="../images/bafilter.png">.</p>
	<p>
	Vyberte Normalize, chceme aby v¹echna na¹e SVCD mìla stejnou základní úroveò hlasitosti.
	</p>
<p>
	Nezapomeòte stisknout <img src="../images/baprocess.png">.
	</p>
<p>
	Nakonec vyberte kodek, v na¹em pøípadì chceme mít MPEG audio.
	Tak¾e kliknìte na A Codec, vyberte <span class="code">FFmpeg MPEG audio</span> a nakonfigurujte jej.
	Napøíklad 224 kbits Stereo.
	</p>
	Poslední krok: kódování! <span class="code">Audio-&gt;Save Audio</span>: video.mp2.
	
	Nebo mù¾ete pou¾ít interní knihovnu tooLAME, kvalita je obecnì lep¹í.	

<p class="secthead"><a name="doc_chap2_sect4">Komprese videa v Avidemuxu </a></p>
<p> 
	První krok je naètení seznamu úprav: <span class="code">Edit-&gt;Load Edit List</span>.
</p>
<p>	Oøízneme obraz, aplikujeme nìjaké <a href="./video.xml.html">filtry</a> a zmìníme velikost pro SVCD.
</p>
<p>	Otevøeme si seznam filtrù pomocí <span class="code">F1</span> nebo <img src="../images/bvfilter.png">. 
</p>
<p>První filtr bude Crop k odstranìní èerných nebo blikajících okrajù. S oøezem ne¹etøete, i malé "neèisté" èásti na okrajích by ztí¾ily kompresi a sní¾ily kvalitu.</p>	
<p>	Mù¾ete také chtít odstranit prokládání. Podle toho jestli pou¾íváte normu PAL nebo NTSC a podle typu zdroje zvolte Deinterlace, PAL Smart, IVTC... Vyzkou¹ejte je v náhledovém oknì a vyberte si ten který preferujete.</p>
	
<p> Pak kliknìte na tlaèítko <span class="code">SVCD res</span> a zmìòte velikost na 480*xxx. 
Zdroj je pova¾ován za 1:1, pokud tomu tak není, udìlejte to ruènì.   
</p>

<p>Poslední krok: kódování</p>
<p>Zvolte a nakonfigurujte video kodek SVCD. Máte-li dost èasu, pou¾ijte dvouprùchodové kódování (Two pass), jinak napø. hodnotu konstantní kvantizace (quantizer) 7.</p>
<p>V obou pøípadech nastavte maximální bitrate na 2300, abychom vyhovìli specifikaci SVCD. Nezapomeòte nastavit video re¾im na Process!</p>

<p><span class="code">File-&gt;Save Video</span>: video.m2v</p>
   
 

<p class="chaphead"><span class="chapnum"><a name="doc_chap3">3.</a></span>Multiplexace zvuku a obrazu</p>
<p>
 Na to existují dva programy:
 
<ul>
   <li>mplex z balíku MJPEG Tools</li>
   <li>tcmplex z transcode
   </li>
</ul>
 Proto¾e jsem mìl nainstalované MJPEG Tools, pou¾il jsem mplex:
  
<ul>
<a name="doc_chap_pre1"></a><table class="ntable" width="100%" cellspacing="0" cellpadding="0" border="0">
<tr><td class="infohead" bgcolor="#7a5ada"><p class="caption">
			Code listing .1</p></td></tr>
<tr><td bgcolor="#ddddff"><pre>$ mplex -f 4 -V -s 2324 -p 1 -o video.mpg video.mp2 video.m2v</pre></td></tr>
</table>
</ul>
 Máte-li nainstalovaný transcode, mù¾ete zkusit:
 
<ul>
<a name="doc_chap_pre2"></a><table class="ntable" width="100%" cellspacing="0" cellpadding="0" border="0">
<tr><td class="infohead" bgcolor="#7a5ada"><p class="caption">
			Code listing .2</p></td></tr>
<tr><td bgcolor="#ddddff"><pre>$ tcmplex -i video.m2v -p video.mp2 -o video.mpg -m s </pre></td></tr>
</table>
</ul>
</p>
<p class="chaphead"><span class="chapnum"><a name="doc_chap4">4.</a></span>Sestavení SVCD image</p>
<p>
 Nemù¾ete soubory zapsat pøímo na CD-R. Pro vytoøení obrazu SVCD 
pou¾ijte vcdimager:
 
<ul>
<a name="doc_chap_pre1"></a><table class="ntable" width="100%" cellspacing="0" cellpadding="0" border="0">
<tr><td class="infohead" bgcolor="#7a5ada"><p class="caption">
			Code listing .1</p></td></tr>
<tr><td bgcolor="#ddddff"><pre>$ vcdimager -t svcd video.mpg  
INFO: scanning mpeg track #0 for scanpoints...   
INFO: writing track 1 (ISO9660)...   
INFO: writing track 2, MPEG2, PAL S (480x576/25fps), 1 audio stream...
finished ok, image created with 1023 sectors (2406096 bytes)
</pre></td></tr>
</table>
</ul>
 Pokud dostanete tuto hlá¹ku:
 
<ul>
<a name="doc_chap_pre2"></a><table class="ntable" width="100%" cellspacing="0" cellpadding="0" border="0">
<tr><td class="infohead" bgcolor="#7a5ada"><p class="caption">
			Code listing .2</p></td></tr>
<tr><td bgcolor="#ddddff"><pre>$ vcdimager -t svcd video.mpg
INFO: scanning mpeg track #0 for scanpoints...
vcdimager: vcd.c:612: _finalize_vcd_iso_track: Assertion `_vcd_salloc_get_highest (obj-&gt;iso_bitmap) + 1 == 225' failed.Aborted (core dumped)
</pre></td></tr>
</table>
</ul>
 mìli byste pou¾ít tcmplex pro multiplexaci <b>nebo</b> vcdimager verze 
&gt;= 0.7.
 
 <b>Budoucnost:
 </b>
 vcdimager také obsahuje dva nástroje zvané vcdxgen a vcdxbuild. 
   
<ul>
<a name="doc_chap_pre3"></a><table class="ntable" width="100%" cellspacing="0" cellpadding="0" border="0">
<tr><td class="infohead" bgcolor="#7a5ada"><p class="caption">
			Code listing .3</p></td></tr>
<tr><td bgcolor="#ddddff"><pre>$;./vcdimager-0.7.13/frontends/xml/vcdxgen -t svcd video.mpg
(Super) VideoCD xml description created successfully as `videocd.xml'
$ ./vcdimager-0.7.13/frontends/xml/vcdxbuild videocd.xml
++ WARN: initializing libvcd 0.7.13 [linux-gnu/i686]
++ WARN:  
++ WARN:  this is the UNSTABLE development branch!
++ WARN:  use only if you know what you are doing
++ WARN:  see http://www.hvrlab.org/~hvr/vcdimager/ for more information++ 
WARN:     INFO: scanning mpeg sequence item #0 for scanpoints...   
INFO: writing track 1 (ISO9660)...   
INFO: writing track 2, MPEG2, PAL 2/3 D1 (480x576/25fps), audio[0]: l2/44.1kHz/224kbps/stereo ...   
INFO: finished ok, image created with 1173 sectors [00:15.48]
</pre></td></tr>
</table>
</ul>
  </p>
  <p class="chaphead"><span class="chapnum"><a name="doc_chap5">5.</a></span>Vypálení image</p>
<ul>
<a name="doc_chap_pre1"></a><table class="ntable" width="100%" cellspacing="0" cellpadding="0" border="0">
<tr><td class="infohead" bgcolor="#7a5ada"><p class="caption">
			Code listing .1</p></td></tr>
<tr><td bgcolor="#ddddff"><pre>$ cdrdao write --device <span class="input">/dev/sg0</span> videocd.cue</pre></td></tr>
</table>
</ul>
Samozøejmì sg0 nahraïte va¹ím skuteèným zaøízením.
<p class="chaphead"><span class="chapnum"><a name="doc_chap6">6.</a></span>Zpìtná extrakce MPEG souboru</p>
 Nìkdy mù¾ete chtít získat zpìt pùvodní MPEG soubory z SVCD.
 
 Z disku:
 
<ul>
<a name="doc_chap_pre1"></a><table class="ntable" width="100%" cellspacing="0" cellpadding="0" border="0">
<tr><td class="infohead" bgcolor="#7a5ada"><p class="caption">
			Code listing .1</p></td></tr>
<tr><td bgcolor="#ddddff"><pre>$ vcdrip --rip -b videocd.bin
INFO: avseq01.mpg: 450 -&gt; 1023</pre></td></tr>
</table>
</ul>
 Z CD-R:
 
<ul>
<a name="doc_chap_pre2"></a><table class="ntable" width="100%" cellspacing="0" cellpadding="0" border="0">
<tr><td class="infohead" bgcolor="#7a5ada"><p class="caption">
			Code listing .2</p></td></tr>
<tr><td bgcolor="#ddddff"><pre>$ vcdrip --rip --cdrom-device=/dev/scd0
INFO: avseq01.mpg: 450 -&gt; 1260</pre></td></tr>
</table>
</ul>
 
 <p class="chaphead"><span class="chapnum"><a name="doc_chap7">7.</a></span>Závìr</p>
 Máte-li s výsledným SVCD problémy, mù¾ete zkusit jeden z následujících tipù:
 <ul>
 <li>Zkuste vcdimager demo  <a href="http://www.vcdimager.org/pub/vcdimager/examples/test_svcd/">image</a>
</li>
 <li>Zkuste mplex nebo tcmplex </li>
 <li>parametry programu vcdimager: </li>
 <a name="doc_chap_pre1"></a><table class="ntable" width="100%" cellspacing="0" cellpadding="0" border="0">
<tr><td class="infohead" bgcolor="#7a5ada"><p class="caption">
			Code listing .1</p></td></tr>
<tr><td bgcolor="#ddddff"><pre>
     --broken-svcd-mode
     --nopbc
     --broken-svcd-mode --update-scan-offsets --nopbc</pre></td></tr>
</table>
</ul>
 <br><br>
</td></tr></table></td></tr></table></body>
</html>
